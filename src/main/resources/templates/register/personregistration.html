<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Registration</title>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</head>
<body>
<div>
    <h5>Registration Page</h5>

    <form th:object="${person}" th:action="save" method="post">
        <div>
            <h6>Personal Data :</h6>

            <label>Id :</label>
            <input type="text" name="id" id="person-id" readonly="readonly" th:field="*{id}"
                   placeholder="Automatically generated">

            <label>Name :</label>
            <input type="text" name="name" id="person-name" th:field="*{name}" placeholder="Type person name">

            <label>LastName : </label>
            <input type="text" name="lastName" id="person-lastname" th:field="*{lastName}"
                   placeholder="Type person last name">
        </div>
        <br>

        <div>
            <label>Age : </label>
            <input type="text" name="age" id="person-age" th:field="*{age}" placeholder="Type person age">

            <label>Occupation : </label>
            <select th:field="*{occupation}">
                <option th:each="o : ${occupations}" th:value="${o.id}" th:text="${o.name}"></option>
            </select>
        </div>

        <div>
            <label>Gender : </label>
            <select th:field="*{gender}">
                <option value="" disabled="disabled" selected="selected">--[Select]--</option>
                <option value="MALE">Male</option>
                <option value="FEMALE">Female</option>
            </select>

            <div>
                <label for="birthDate">Birth Date : </label>
                <input type="text" name="birthDate" class="datepicker" id="birthDate" th:field="*{birthDate}"
                       placeholder="Type the birth date">
            </div>
        </div>

        <div>
            <h6>Adress :</h6>

            <br> <br>

            <div>

                <div>
                    <label>Cep : </label>
                    <input type="text" name="cep" id="cep" th:field="*{address.cep}" placeholder="Type a valid CEP">
                </div>

                <div>
                    <label>Street : </label>
                    <input type="text" name="rua" id="rua" th:field="*{address.rua}"
                           placeholder="Automatically generated">
                </div>

            </div>

            <div>

                <div>
                    <label>District : </label>
                    <input type="text" name="bairro" id="bairro" th:field="*{address.bairro}"
                           placeholder="Automatically generated">
                </div>

                <div>
                    <label>City : </label>
                    <input type="text" name="cidade" id="cidade" th:field="*{address.cidade}"
                           placeholder="Automatically generated">
                </div>
            </div>

            <div>
                <div>
                    <label>UF : </label>
                    <input type="text" name="uf" id="uf" th:field="*{address.uf}" placeholder="Automatically generated">
                </div>

                <div>
                    <label>IBGE : </label>
                    <input type="text" name="ibge" id="ibge" th:field="*{address.ibge}"
                           placeholder="Automatically generated">
                </div>
            </div>

            <div>
                <button type="submit" name="button">Save</button>

                <button type="reset">Clean</button>
            </div>
        </div>
    </form>

    <br/> <br/>

    <table>
        <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>LastName</th>
            <th>Edit</th>
            <th>Delete</th>
        </tr>
        </thead>

        <tr th:each="person : ${peoplelist}">
            <td th:text="${person.id}"></td>
            <td th:text="${person.name}"></td>
            <td th:text="${person.lastName}"></td>
            <td><a>Edit</a></td>
            <td><a>Delete</a></td>
        </tr>
    </table>
</div>

<script>
    $(document).ready(
        function () {
            // load the datepicker
            $('.datepicker').datepicker({
                format: "mm-dd-yyyy"
            });

            function cleanForm() {
                $("#rua").val("");
                $("#bairro").val("");
                $("#cidade").val("");
                $("#uf").val("");
                $("#ibge").val("");
            }

            $("#cep").blur(
                function () {

                    var cep = $(this).val().replace(/\D/g, '');

                    if (cep != "") {
                        var validacep = /^[0-9]{8}$/;

                        if (validacep.test(cep)) {

                            $("#rua").val("...");
                            $("#bairro").val("...");
                            $("#cidade").val("...");
                            $("#uf").val("...");
                            $("#ibge").val("...");

                            $.getJSON("https://viacep.com.br/ws/" + cep + "/json/?callback=?",
                                function (dados) {
                                    if (!("erro" in dados)) {
                                        $("#rua").val(dados.logradouro);
                                        $("#bairro").val(dados.bairro);
                                        $("#cidade").val(dados.localidade);
                                        $("#uf").val(dados.uf);
                                        $("#ibge").val(dados.ibge);
                                    } else {
                                        //cannot found CEP
                                        cleanForm();
                                        alert("CEP not found.");
                                    }
                                });
                        } else {
                            //invalid CEP
                            cleanForm();
                            alert("Invalid cep format");
                        }
                    } else {
                        cleanForm();
                    }
                });
        });
</script>

</body>
</html>